<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/feather-icons"></script>

    <style>
        :root {
            --primary-color: #DB1472;
            --secondary-color: #F8B81F;
            --text-color: #334155;
            --text-light: #64748b;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --font-sans: 'Inter', sans-serif;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --border-radius: 0.75rem;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-sans);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
        }
        
        /* --- Estilos de Visibilidade --- */
        .view {
            display: none;
        }
        .view.active {
            display: block;
        }

        /* --- Estilos da Landing Page --- */
        #landing-view.active {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .landing-box {
            text-align: center;
            background-color: var(--card-bg);
            padding: 3rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            max-width: 450px;
            width: 100%;
        }
        .landing-box h1 {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }
        .landing-box p {
            color: var(--text-light);
            margin-bottom: 2rem;
        }
        .landing-box .btn-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .landing-box .btn {
            text-decoration: none;
            text-align: center;
        }

        /* --- Estilos Comuns dos Painéis --- */
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 250px;
            background-color: var(--card-bg);
            border-right: 1px solid var(--border-color);
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 2rem;
            text-align: center;
        }
        .nav-menu { list-style: none; flex-grow: 1; }
        .nav-item a {
            display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem;
            border-radius: 0.5rem; text-decoration: none; color: var(--text-light);
            font-weight: 500; transition: background-color 0.2s, color 0.2s;
        }
        .nav-item a:hover { background-color: #f1f5f9; color: var(--text-color); }
        .nav-item a.active { background-color: var(--primary-color); color: white; }
        .sidebar-footer { font-size: 0.8rem; color: #94a3b8; text-align: center; margin-top: 1rem; }
        .main-content { flex-grow: 1; padding: 2rem; overflow-y: auto; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .page-header h1 { font-size: 1.75rem; font-weight: 700; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 0.6rem 1.25rem; border-radius: 0.5rem; border: none; font-weight: 600; font-size: 0.9rem; cursor: pointer; transition: all 0.2s ease; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-secondary { background-color: #334155; color: white; }
        .btn-secondary:hover { opacity: 0.9; }
        .btn-success { background-color: var(--success-color); color: white; }
        .btn-success:hover { opacity: 0.9; }
        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-danger:hover { opacity: 0.9; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background-color: var(--card-bg); padding: 1.5rem; border-radius: var(--border-radius); box-shadow: var(--shadow); }
        .stat-card-title { font-size: 0.9rem; color: var(--text-light); margin-bottom: 0.5rem; }
        .stat-card-value { font-size: 2rem; font-weight: 700; }

        .table-container { background-color: var(--card-bg); border-radius: var(--border-radius); box-shadow: var(--shadow); overflow-x: auto; }
        .product-table { width: 100%; border-collapse: collapse; }
        .product-table th, .product-table td { padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-color); white-space: nowrap; }
        .product-table th { background-color: #f8fafc; font-size: 0.8rem; text-transform: uppercase; color: var(--text-light); }
        .product-table td { font-size: 0.9rem; vertical-align: middle; }
        .product-image { width: 40px; height: 40px; object-fit: cover; border-radius: 0.25rem; }
        
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; text-transform: capitalize; }
        .status-badge.ativo, .status-badge.aprovado { background-color: #dcfce7; color: #16a34a; }
        .status-badge.sem_estoque, .status-badge.reprovado { background-color: #fee2e2; color: #dc2626; }
        .status-badge.em_analise { background-color: #fef3c7; color: #d97706; }
        
        .toggle-switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(20px); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: var(--card-bg); padding: 2rem; border-radius: var(--border-radius); width: 90%; max-width: 600px; box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .modal-header h3 { font-size: 1.25rem; }
        .modal-close-btn { background: none; border: none; cursor: pointer; color: var(--text-light); }
        
        .modal-body-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 1.5rem; align-items: flex-start; }
        .modal-image-container img { width: 100%; height: auto; border-radius: var(--border-radius); object-fit: cover; border: 1px solid var(--border-color); }
        @media (max-width: 640px) {
            .modal-body-grid { grid-template-columns: 1fr; }
            .modal-image-container { text-align: center; margin-bottom: 1rem; }
            .modal-image-container img { max-width: 200px; }
        }

        .modal-footer { margin-top: 1.5rem; display: flex; justify-content: flex-end; gap: 0.75rem; }
        .info-list { list-style: none; padding: 0; }
        .info-list li { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color); }
        .info-list li:last-child { border-bottom: none; }
        .info-list strong { color: var(--text-color); }

        #toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: #333; color: white; padding: 1rem 1.5rem; border-radius: 0.5rem; transition: bottom 0.5s ease; z-index: 2000; box-shadow: var(--shadow); }
        
        .stock-badge { padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; }
        .stock-badge.in-stock { background-color: #dcfce7; color: #16a34a; }
        .stock-badge.out-of-stock { background-color: #fee2e2; color: #dc2626; }

        .page-controls { margin-bottom: 1.5rem; }
        .search-input, .form-group select {
            width: 100%; max-width: 400px; padding: 0.75rem 1rem; border: 1px solid var(--border-color);
            border-radius: 0.5rem; font-size: 0.9rem; background-color: var(--card-bg);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .search-input:focus, .form-group select:focus {
            outline: none; border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(219, 20, 114, 0.2);
        }
        
        .variacao_nome {
            font-weight: 600; color: var(--primary-color); background-color: #fce7f3;
            padding: 0.2rem 0.6rem; border-radius: 0.375rem; display: inline-block;
        }
        .placeholder-card {
            background-color: var(--card-bg); padding: 4rem 2rem; border-radius: var(--border-radius);
            box-shadow: var(--shadow); text-align: center; color: var(--text-light);
        }

        /* --- Estilos da Página de Configurações e Promoções --- */
        .settings-section {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }
        .settings-section h2 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        .form-group input[type="text"],
        .form-group input[type="tel"],
        .form-group input[type="number"],
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.9rem;
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        .logo-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--border-color);
            margin-top: 1rem;
        }
        .banner-option {
            margin-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1.5rem;
        }
        .banner-preview {
            display: flex;
            gap: 1rem;
            background-color: #f1f5f9;
            border: 2px dashed var(--border-color);
            padding: 1rem;
            border-radius: var(--border-radius);
            min-height: 150px;
            align-items: center;
            justify-content: center;
        }
        .banner-preview img {
            max-width: 100%;
            max-height: 120px;
            object-fit: cover;
            border-radius: 0.5rem;
        }
        .banner-upload-group {
            margin-top: 1rem;
        }
    </style>
</head>
<body>

    <!-- VISÃO DA LANDING PAGE -->
    <div id="landing-view" class="view active">
        <div class="landing-box">
            <h1>Bem-vindo(a) ao Sistema</h1>
            <p>Selecione o painel que deseja acessar.</p>
            <div class="btn-group">
                <button id="show-empresa-panel" class="btn btn-primary">Acessar Painel da Empresa</button>
                <button id="show-revendedor-panel" class="btn btn-secondary">Acessar Painel do Revendedor</button>
            </div>
        </div>
    </div>

    <!-- VISÃO DO PAINEL DA EMPRESA -->
    <div id="empresa-view" class="view">
        <div class="app-container">
            <aside class="sidebar">
                <div class="sidebar-header">Meu ERP</div>
                <ul class="nav-menu" id="empresa-nav">
                    <li class="nav-item"><a href="#" class="nav-link active" data-page="dashboard"><i data-feather="home"></i> Visão Geral</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-page="products"><i data-feather="package"></i> Produtos</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-page="catalog"><i data-feather="book-open"></i> Catálogo Revenda</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-page="resellers"><i data-feather="users"></i> Gerenciar Revendedoras</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-page="sync"><i data-feather="refresh-cw"></i> Sincronização</a></li>
                </ul>
                <div class="sidebar-footer"><p>&copy; 2025 - Painel de Gestão</p></div>
            </aside>
            <main class="main-content">
                <section id="dashboard" class="page active">
                    <div class="page-header"><h1>Visão Geral</h1></div>
                    <div class="stats-grid">
                        <div class="stat-card"><p class="stat-card-title">Total de Produtos</p><p class="stat-card-value" id="stat-total-products">0</p></div>
                        <div class="stat-card"><p class="stat-card-title">Produtos Ativos</p><p class="stat-card-value" id="stat-active-products">0</p></div>
                        <div class="stat-card"><p class="stat-card-title">Publicados para Revenda</p><p class="stat-card-value" id="stat-published-products">0</p></div>
                        <div class="stat-card"><p class="stat-card-title">Revendedoras Ativas</p><p class="stat-card-value" id="stat-active-resellers">0</p></div>
                    </div>
                </section>
                <section id="products" class="page">
                    <div class="page-header"><h1>Todos os Produtos</h1></div>
                    <div class="page-controls"><input type="text" id="product-search-input" class="search-input" placeholder="Buscar por nome do produto..."></div>
                    <div class="table-container">
                        <table class="product-table">
                            <thead><tr><th>Imagem</th><th>Nome</th><th>Preço</th><th>Status</th><th>Publicar</th><th>Editar</th></tr></thead>
                            <tbody id="products-table-body"></tbody>
                        </table>
                    </div>
                </section>
                <section id="catalog" class="page">
                     <div class="page-header"><h1>Catálogo para Revendedoras</h1></div>
                    <div class="table-container">
                        <table class="product-table">
                            <thead><tr><th>Imagem</th><th>Nome</th><th>Preço</th><th>Variações Disponíveis</th></tr></thead>
                            <tbody id="catalog-table-body"></tbody>
                        </table>
                    </div>
                </section>
                <section id="resellers" class="page">
                    <div class="page-header"><h1>Gerenciar Revendedoras</h1></div>
                    <div class="table-container">
                        <table class="product-table">
                            <thead><tr><th>Nome</th><th>Documento</th><th>Telefone</th><th>Status</th><th>Ações</th></tr></thead>
                            <tbody id="resellers-table-body"></tbody>
                        </table>
                    </div>
                </section>
                <section id="sync" class="page">
                    <div class="page-header"><h1>Sincronização com FacilZap</h1></div>
                    <div class="stat-card">
                        <p>Clique nos botões abaixo para gerenciar a integração com a API.</p>
                        <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                            <button class="btn btn-primary" onclick="syncFromFacilZap()"><i data-feather="refresh-cw"></i> Sincronizar Produtos</button>
                            <button class="btn btn-secondary" onclick="testApiConnection()">Testar Conexão</button>
                        </div>
                        <p id="last-sync-time" style="margin-top: 1rem; color: var(--text-light); font-size: 0.9rem;">Última sincronização: Nunca</p>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- VISÃO DO PAINEL DA REVENDEDORA -->
    <div id="revendedor-view" class="view">
        <div class="app-container">
            <aside class="sidebar">
                <div class="sidebar-header">Painel Revenda</div>
                <ul class="nav-menu" id="revendedor-nav">
                    <li class="nav-item"><a href="#" class="nav-link active" data-page="reseller-products"><i data-feather="tag"></i> Produtos</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-page="reseller-promotions"><i data-feather="gift"></i> Promoções</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-page="reseller-sales"><i data-feather="dollar-sign"></i> Vendas</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-page="reseller-settings"><i data-feather="settings"></i> Configurações do Catálogo</a></li>
                </ul>
                <div class="sidebar-footer"><p>&copy; 2025 - Catálogo de Revenda</p></div>
            </aside>
            <main class="main-content">
                <section id="reseller-products" class="page active">
                    <div class="page-header"><h1>Meus Produtos</h1></div>
                    <div class="page-controls" style="background-color: var(--card-bg); padding: 1rem; border-radius: var(--border-radius); margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                        <h3 class="text-lg font-semibold">Gerenciar Preços</h3>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="number" id="mass-margin-input" class="search-input" placeholder="Margem de Lucro (%)" style="width: 180px;">
                            <button id="apply-mass-margin" class="btn btn-primary">Aplicar em Massa</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="product-table">
                            <thead>
                                <tr>
                                    <th>Imagem</th>
                                    <th>Nome</th>
                                    <th>Preço Base</th>
                                    <th>Sua Margem (%)</th>
                                    <th>Preço Final</th>
                                    <th>Ativar no Catálogo</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="reseller-products-table-body"></tbody>
                        </table>
                    </div>
                </section>
                <section id="reseller-promotions" class="page">
                    <div class="page-header"><h1>Estratégias de Promoção</h1></div>
                    
                    <!-- Seção Cupom de Desconto -->
                    <div class="settings-section">
                        <h2><i data-feather="scissors" class="mr-2"></i>Cupom de Desconto</h2>
                        <div class="form-grid">
                            <div class="form-group"><label for="coupon-code">Código do Cupom</label><input type="text" id="coupon-code" placeholder="EX: PROMO10"></div>
                            <div class="form-group"><label for="coupon-type">Tipo</label><select id="coupon-type" class="search-input"><option value="percentage">Percentual (%)</option><option value="fixed">Fixo (R$)</option></select></div>
                            <div class="form-group"><label for="coupon-value">Valor do Desconto</label><input type="number" id="coupon-value" placeholder="10"></div>
                            <div class="form-group" style="justify-content: flex-end;"><button class="btn btn-success">Criar Cupom</button></div>
                        </div>
                    </div>

                    <!-- Seção Leve Mais, Pague Menos -->
                    <div class="settings-section">
                        <h2><i data-feather="shopping-bag" class="mr-2"></i>Leve Mais, Pague Menos</h2>
                        <div class="form-grid">
                            <div class="form-group"><label for="buy-x">Leve (Quantidade)</label><input type="number" id="buy-x" placeholder="3"></div>
                            <div class="form-group"><label for="pay-y">Pague (Quantidade)</label><input type="number" id="pay-y" placeholder="2"></div>
                            <div class="form-group"><label for="buy-pay-product">Aplicar ao Produto</label><select id="buy-pay-product" class="search-input"><option>Selecione um produto...</option></select></div>
                            <div class="form-group" style="justify-content: flex-end;"><button class="btn btn-success">Criar Oferta</button></div>
                        </div>
                    </div>

                    <!-- Seção Oferta Relâmpago -->
                    <div class="settings-section">
                        <h2><i data-feather="zap" class="mr-2"></i>Oferta Relâmpago</h2>
                        <div class="form-grid">
                            <div class="form-group"><label for="flash-product">Produto em Oferta</label><select id="flash-product" class="search-input"><option>Selecione um produto...</option></select></div>
                            <div class="form-group"><label for="flash-price">Preço Promocional (R$)</label><input type="number" id="flash-price" placeholder="49.90"></div>
                            <div class="form-group"><label for="flash-duration">Duração (horas)</label><input type="number" id="flash-duration" placeholder="24"></div>
                            <div class="form-group" style="justify-content: flex-end;"><button class="btn btn-success">Iniciar Oferta</button></div>
                        </div>
                    </div>

                    <!-- Seção Brinde -->
                    <div class="settings-section">
                        <h2><i data-feather="gift" class="mr-2"></i>Brinde Especial</h2>
                        <div class="form-grid">
                            <div class="form-group"><label for="gift-condition">Condição</label><select id="gift-condition" class="search-input"><option value="value">Por Valor de Compra</option><option value="quantity">Por Quantidade de Itens</option></select></div>
                            <div class="form-group"><label for="gift-condition-value">Valor Mínimo (R$ ou Qtd)</label><input type="number" id="gift-condition-value" placeholder="150"></div>
                            <div class="form-group"><label for="gift-description">Descrição do Brinde</label><input type="text" id="gift-description" placeholder="Ex: Uma necessaire exclusiva"></div>
                            <div class="form-group" style="justify-content: flex-end;"><button class="btn btn-success">Criar Brinde</button></div>
                        </div>
                    </div>
                    
                    <!-- Seção Frete Grátis (Sugestão) -->
                    <div class="settings-section">
                        <h2><i data-feather="truck" class="mr-2"></i>Frete Grátis</h2>
                        <div class="form-grid">
                            <div class="form-group"><label for="free-shipping-value">Frete grátis para compras acima de (R$)</label><input type="number" id="free-shipping-value" placeholder="250"></div>
                            <div class="form-group" style="justify-content: flex-end;"><button class="btn btn-success">Ativar Frete Grátis</button></div>
                        </div>
                    </div>
                </section>
                <section id="reseller-sales" class="page">
                     <div class="page-header"><h1>Minhas Vendas</h1></div>
                     <div class="placeholder-card">
                        <i data-feather="dollar-sign" class="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                        <p>Acompanhe o histórico e o desempenho de suas vendas.</p>
                    </div>
                </section>
                <section id="reseller-settings" class="page">
                    <div class="page-header"><h1>Configurações do meu Catálogo</h1></div>
                    <div class="settings-section">
                        <h2>Identidade Visual</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="logo-upload">Logo da Marca</label>
                                <input type="file" id="logo-upload" accept="image/*">
                                <img id="logo-preview" class="logo-preview" src="https://placehold.co/100x100/e2e8f0/94a3b8?text=Logo" alt="Prévia da logo">
                            </div>
                            <div class="form-group">
                                <label for="brand-name-input">Nome da Marca</label>
                                <input type="text" id="brand-name-input" placeholder="Ex: Maria Modas">
                            </div>
                            <div class="form-group">
                                <label for="primary-color-input">Cor Primária</label>
                                <input type="color" id="primary-color-input" value="#DB1472">
                            </div>
                            <div class="form-group">
                                <label for="secondary-color-input">Cor de Destaque</label>
                                <input type="color" id="secondary-color-input" value="#F8B81F">
                            </div>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h2>Informações do Catálogo</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="contact-phone-input">Contato (WhatsApp)</label>
                                <input type="tel" id="contact-phone-input" placeholder="(XX) 9XXXX-XXXX">
                            </div>
                            <div class="form-group">
                                <label for="instagram-input">Instagram</label>
                                <input type="text" id="instagram-input" placeholder="@seunome">
                            </div>
                        </div>
                         <div class="form-group" style="margin-top: 1.5rem;">
                            <label for="description-textarea">Descrição Curta</label>
                            <textarea id="description-textarea" placeholder="Fale um pouco sobre sua loja..."></textarea>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h2>Banners do Catálogo</h2>
                        <p class="text-light mb-4">Envie imagens para os banners que aparecerão no topo do seu catálogo.</p>
                        <div class="banner-option">
                            <h3 class="font-semibold mb-2">Banner Principal (Desktop e Mobile)</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Imagem para Desktop (1200x400px)</label>
                                    <input type="file" class="banner-upload" data-banner-id="desktop-main" accept="image/*">
                                    <div class="banner-preview mt-2">
                                        <img id="banner-preview-desktop-main" src="https://placehold.co/600x200/e2e8f0/94a3b8?text=Banner+Desktop" alt="Prévia Banner Desktop">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Imagem para Mobile (600x400px)</label>
                                    <input type="file" class="banner-upload" data-banner-id="mobile-main" accept="image/*">
                                    <div class="banner-preview mt-2">
                                        <img id="banner-preview-mobile-main" src="https://placehold.co/300x200/e2e8f0/94a3b8?text=Banner+Mobile" alt="Prévia Banner Mobile">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="justify-content: flex-start;">
                        <button id="save-settings-btn" class="btn btn-success"><i data-feather="save"></i> Salvar Configurações</button>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- MODAIS (COMPARTILHADOS) -->
    <div id="product-details-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modal-product-name"></h3><button class="modal-close-btn" onclick="closeModal('product-details-modal')"><i data-feather="x"></i></button></div>
            <div class="modal-body-grid">
                <div class="modal-image-container"><img id="modal-main-image" src="" alt="Imagem do Produto"></div>
                <div class="modal-details-container">
                    <table class="product-table">
                        <thead><tr><th>Variação</th><th>Estoque</th></tr></thead>
                        <tbody id="modal-variations-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="reseller-review-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modal-reseller-name">Analisar Cadastro</h3><button class="modal-close-btn" onclick="closeModal('reseller-review-modal')"><i data-feather="x"></i></button></div>
            <div class="modal-body">
                <ul class="info-list">
                    <li><strong>Nome:</strong> <span id="review-reseller-name"></span></li>
                    <li><strong>Documento (CPF/CNPJ):</strong> <span id="review-reseller-doc"></span></li>
                    <li><strong>Telefone:</strong> <span id="review-reseller-phone"></span></li>
                    <li><strong>E-mail:</strong> <span id="review-reseller-email"></span></li>
                </ul>
            </div>
            <div class="modal-footer">
                <button id="reprove-btn" class="btn btn-danger">Reprovar</button>
                <button id="approve-btn" class="btn btn-success">Aprovar</button>
            </div>
        </div>
    </div>
    <div id="reseller-product-edit-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modal-reseller-product-name">Editar Margem</h3><button class="modal-close-btn" onclick="closeModal('reseller-product-edit-modal')"><i data-feather="x"></i></button></div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem; color: var(--text-light);">Defina sua margem de lucro para este produto.</p>
                <label for="reseller-margin-input" style="font-weight: 600;">Margem de Lucro (%)</label>
                <input type="number" id="reseller-margin-input" class="search-input" style="width: 100%; margin-top: 0.5rem;" placeholder="Ex: 30">
            </div>
            <div class="modal-footer">
                <button id="save-reseller-margin-btn" class="btn btn-success">Salvar</button>
            </div>
        </div>
    </div>
    <div id="toast"></div>

    <script>
    // --- DADOS MOCKADOS E VARIÁVEIS GLOBAIS ---
    let mockResellers = [
        { id: 1, name: 'Ana Silva', doc: '123.456.789-00', phone: '(11) 98765-4321', email: 'ana.silva@example.com', status: 'em_analise' },
        { id: 2, name: 'Joana Modas LTDA', doc: '12.345.678/0001-99', phone: '(21) 99999-8888', email: 'contato@joanamodas.com', status: 'aprovado' },
    ];
    let allApiProducts = [];
    let publishedProductIds = [];
    let resellerProductMargins = {}; // { productId: margin, ... }
    let resellerActiveProductIds = []; // { productId, ... }
    let resellerSettings = {};

    // --- INICIALIZAÇÃO ---
    document.addEventListener('DOMContentLoaded', () => {
        setupViewSwitcher();
        setupEmpresaPanel();
        setupRevendedorPanel();
        feather.replace();
    });
    
    // --- LÓGICA DE TROCA DE PAINEL ---
    function setupViewSwitcher() {
        const landingView = document.getElementById('landing-view');
        const empresaView = document.getElementById('empresa-view');
        const revendedorView = document.getElementById('revendedor-view');

        document.getElementById('show-empresa-panel').addEventListener('click', () => {
            landingView.classList.remove('active');
            empresaView.classList.add('active');
            feather.replace();
        });

        document.getElementById('show-revendedor-panel').addEventListener('click', () => {
            landingView.classList.remove('active');
            revendedorView.classList.add('active');
            renderResellerProductsTable();
            feather.replace();
        });
    }

    // --- LÓGICA DO PAINEL DA EMPRESA ---
    function setupEmpresaPanel() {
        loadLocalData();
        setupEmpresaNavigation();
        updateDashboard();
        renderAllTables();

        document.getElementById('product-search-input').addEventListener('keyup', (e) => {
            renderProductsTable(e.target.value.toLowerCase());
        });
    }

    function setupEmpresaNavigation() {
        const navContainer = document.getElementById('empresa-nav');
        navContainer.addEventListener('click', (e) => {
            const link = e.target.closest('.nav-link');
            if (!link) return;
            
            e.preventDefault();
            const pageId = link.dataset.page;
            
            navContainer.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');

            const mainContent = document.querySelector('#empresa-view .main-content');
            mainContent.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            mainContent.querySelector(`#${pageId}`).classList.add('active');
            
            feather.replace();
        });
    }

    function showToast(message, type = 'info') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.style.backgroundColor = type === 'success' ? 'var(--success-color)' : (type === 'error' ? 'var(--danger-color)' : '#333');
        toast.style.bottom = '20px';
        setTimeout(() => { toast.style.bottom = '-100px'; }, 3000);
    }

    function proxyImageUrl(url) {
        if (!url || typeof url !== 'string' || url.trim() === '') {
            return 'https://placehold.co/300x300/DB1472/FFFFFF?text=Sem+Imagem';
        }
        return url.startsWith('http') ? `/facilzap-images?url=${encodeURIComponent(url)}` : `/facilzap-images?url=${encodeURIComponent('https://' + url)}`;
    }
    
    function processVariations(estoqueData) {
        if (!estoqueData) return [];
        
        const extractVariationName = (item) => {
            if (typeof item === 'string') return item;
            if (typeof item === 'object' && item !== null) return item.tamanho || item.variacao || item.nome || 'N/A';
            return String(item);
        };

        if (typeof estoqueData === 'number') return [{ nome: 'Único', quantidade: estoqueData }];
        if (typeof estoqueData === 'string') {
            try {
                const parsed = JSON.parse(estoqueData);
                return Array.isArray(parsed) 
                    ? parsed.map(item => ({ nome: extractVariationName(item), quantidade: parseInt(item.estoque || item.quantidade || 0) }))
                    : [{ nome: extractVariationName(parsed), quantidade: parseInt(parsed.estoque || parsed.quantidade || 0) }];
            } catch (e) { return [{ nome: estoqueData, quantidade: 0 }]; }
        }
        if (Array.isArray(estoqueData)) return estoqueData.map(item => ({ nome: extractVariationName(item), quantidade: parseInt(item.estoque || item.quantidade || 0) }));
        if (typeof estoqueData === 'object' && estoqueData !== null) return [{ nome: extractVariationName(estoqueData), quantidade: parseInt(estoqueData.estoque || estoqueData.quantidade || 0) }];
        return [];
    }

    function loadLocalData() {
        const savedProducts = localStorage.getItem('erpProducts');
        if (savedProducts) allApiProducts = JSON.parse(savedProducts);
        
        const savedPublished = localStorage.getItem('erpPublished');
        if (savedPublished) publishedProductIds = JSON.parse(savedPublished);

        const savedResellers = localStorage.getItem('erpResellers');
        if (savedResellers) mockResellers = JSON.parse(savedResellers);

        const savedMargins = localStorage.getItem('resellerMargins');
        if (savedMargins) resellerProductMargins = JSON.parse(savedMargins);

        const savedResellerActive = localStorage.getItem('resellerActiveProducts');
        if (savedResellerActive) resellerActiveProductIds = JSON.parse(savedResellerActive);

        const savedSettings = localStorage.getItem('resellerSettings');
        if (savedSettings) resellerSettings = JSON.parse(savedSettings);
        
        const savedTime = localStorage.getItem('erpLastSync');
        if (savedTime) document.getElementById('last-sync-time').textContent = `Última sincronização: ${savedTime}`;
    }

    async function syncFromFacilZap() {
        showToast('Iniciando sincronização...', 'info');
        const syncButton = document.querySelector('#empresa-view button[onclick="syncFromFacilZap()"]');
        if (syncButton) syncButton.disabled = true;

        allApiProducts = [];
        let currentPage = 1;
        const MAX_PAGES = 200;

        try {
            while (currentPage <= MAX_PAGES) {
                showToast(`Buscando página ${currentPage}...`, 'info');
                const response = await fetch(`/api/facilzap-proxy?page=${currentPage}&length=100`);
                if (!response.ok) throw new Error(`Erro na API: ${response.statusText}`);
                const data = await response.json();
                const productsFromPage = data.data || [];
                if (productsFromPage.length === 0) break;

                const processedProducts = productsFromPage.map(p => {
                    const variacoes = processVariations(p.estoque);
                    const estoqueTotal = variacoes.reduce((total, v) => total + v.quantidade, 0);
                    const imagens = typeof p.imagem === 'string' ? p.imagem.split(',').map(url => url.trim()) : [];
                    return { id: p.id, nome: p.nome || 'Nome não informado', sku: p.sku || 'N/A', preco_original: parseFloat(p.preco || 0), imagem: imagens[0] || null, estoque_total: estoqueTotal, variacoes: variacoes, status: estoqueTotal > 0 ? 'ativo' : 'sem_estoque' };
                });
                
                allApiProducts.push(...processedProducts);
                currentPage++;
            }

            allApiProducts.sort((a, b) => (a.status === 'ativo' ? -1 : 1));
            localStorage.setItem('erpProducts', JSON.stringify(allApiProducts));
            updateLastSyncTime();
            showToast(`Sincronização completa! ${allApiProducts.length} produtos carregados.`, 'success');
            renderAllTables();
            updateDashboard();

        } catch (error) {
            console.error("Erro na sincronização:", error);
            showToast(`Falha: ${error.message}`, 'error');
        } finally {
            if (syncButton) syncButton.disabled = false;
        }
    }

    async function testApiConnection() {
        showToast('Testando conexão...', 'info');
        try {
            const response = await fetch('/api/facilzap-proxy?page=1&length=5');
            if (response.ok && (await response.json()).data) {
                showToast('Conexão com API OK!', 'success');
            } else {
                throw new Error('Resposta inválida da API.');
            }
        } catch (error) {
            showToast(`Erro na conexão: ${error.message}`, 'error');
        }
    }

    function updateLastSyncTime() {
        const now = new Date().toLocaleString('pt-BR');
        document.getElementById('last-sync-time').textContent = `Última sincronização: ${now}`;
        localStorage.setItem('erpLastSync', now);
    }
    
    function updateDashboard() {
        document.getElementById('stat-total-products').textContent = allApiProducts.length;
        document.getElementById('stat-active-products').textContent = allApiProducts.filter(p => p.status === 'ativo').length;
        document.getElementById('stat-published-products').textContent = publishedProductIds.length;
        document.getElementById('stat-active-resellers').textContent = mockResellers.filter(r => r.status === 'aprovado').length;
    }

    function renderAllTables() {
        const searchTerm = document.getElementById('product-search-input').value.toLowerCase();
        renderProductsTable(searchTerm);
        renderCatalogTable();
        renderResellersTable();
    }

    function renderProductsTable(searchTerm = '') {
        const tbody = document.getElementById('products-table-body');
        tbody.innerHTML = '';

        const filteredProducts = allApiProducts.filter(p => p.nome.toLowerCase().includes(searchTerm));

        if (filteredProducts.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhum produto encontrado.</td></tr>';
            return;
        }

        filteredProducts.forEach(p => {
            const row = tbody.insertRow();
            const isPublished = publishedProductIds.includes(p.id);

            row.insertCell().innerHTML = `<img src="${proxyImageUrl(p.imagem)}" alt="${p.nome}" class="product-image" onerror="this.src='https://placehold.co/40x40/DB1472/FFFFFF?text=X'">`;
            row.insertCell().textContent = p.nome;
            row.insertCell().textContent = `R$ ${p.preco_original.toFixed(2)}`;
            row.insertCell().innerHTML = `<span class="status-badge ${p.status}">${p.status.replace('_', ' ')}</span>`;
            
            const publishCell = row.insertCell();
            const toggleLabel = document.createElement('label');
            toggleLabel.className = 'toggle-switch';
            const toggleInput = document.createElement('input');
            toggleInput.type = 'checkbox';
            toggleInput.checked = isPublished;
            toggleInput.addEventListener('change', () => togglePublished(p.id));
            toggleLabel.appendChild(toggleInput);
            toggleLabel.appendChild(document.createElement('span')).className = 'slider';
            publishCell.appendChild(toggleLabel);

            const actionsCell = row.insertCell();
            const viewButton = document.createElement('button');
            viewButton.className = 'btn';
            viewButton.style.padding = '0.25rem 0.5rem';
            viewButton.innerHTML = `<i data-feather="edit-2"></i>`;
            viewButton.addEventListener('click', () => showProductDetails(p.id));
            actionsCell.appendChild(viewButton);
        });
        feather.replace();
    }

    function renderCatalogTable() {
        const tbody = document.getElementById('catalog-table-body');
        tbody.innerHTML = '';
        const publishedProducts = allApiProducts.filter(p => publishedProductIds.includes(p.id) && p.status === 'ativo');
        if (publishedProducts.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Nenhum produto publicado para revenda.</td></tr>';
            return;
        }
        publishedProducts.forEach(p => {
            const variationsText = p.variacoes.filter(v => v.quantidade > 0).map(v => v.nome).join(', ');
            tbody.insertRow().innerHTML = `
                <td><img src="${proxyImageUrl(p.imagem)}" alt="${p.nome}" class="product-image" onerror="this.src='https://placehold.co/40x40/DB1472/FFFFFF?text=X'"></td>
                <td>${p.nome}</td>
                <td>R$ ${p.preco_original.toFixed(2)}</td>
                <td>${variationsText || 'Nenhuma'}</td>`;
        });
    }

    function renderResellersTable() {
        const tbody = document.getElementById('resellers-table-body');
        tbody.innerHTML = '';
        mockResellers.forEach(r => {
            const row = tbody.insertRow();
            row.insertCell().textContent = r.name;
            row.insertCell().textContent = r.doc;
            row.insertCell().textContent = r.phone;
            row.insertCell().innerHTML = `<span class="status-badge ${r.status}">${r.status.replace('_', ' ')}</span>`;
            
            const actionsCell = row.insertCell();
            const reviewButton = document.createElement('button');
            reviewButton.className = 'btn';
            reviewButton.style.padding = '0.25rem 0.5rem';
            reviewButton.innerHTML = `<i data-feather="edit"></i> Analisar`;
            reviewButton.addEventListener('click', () => showResellerReview(r.id));
            actionsCell.appendChild(reviewButton);
        });
        feather.replace();
    }

    function showProductDetails(productId) {
        const product = allApiProducts.find(p => p.id === productId);
        if (!product) return;
        
        document.getElementById('modal-product-name').textContent = product.nome;
        document.getElementById('modal-main-image').src = proxyImageUrl(product.imagem);
        
        const tbody = document.getElementById('modal-variations-tbody');
        tbody.innerHTML = '';
        
        if (product.variacoes && product.variacoes.length > 0) {
            product.variacoes.forEach(v => {
                const row = tbody.insertRow();
                const nameCell = row.insertCell();
                const nameSpan = document.createElement('span');
                nameSpan.className = 'variacao_nome';
                nameSpan.textContent = typeof v.nome === 'string' ? v.nome : (v.nome?.toString() || 'N/A');
                nameCell.appendChild(nameSpan);
                
                const stockCell = row.insertCell();
                const badge = document.createElement('span');
                badge.className = `stock-badge ${v.quantidade > 0 ? 'in-stock' : 'out-of-stock'}`;
                badge.textContent = v.quantidade > 0 ? `Disponível (${v.quantidade})` : 'Esgotado';
                stockCell.appendChild(badge);
            });
        } else {
            tbody.innerHTML = '<tr><td colspan="2" style="text-align:center;">Nenhuma variação encontrada.</td></tr>';
        }
        
        document.getElementById('product-details-modal').classList.add('active');
        feather.replace();
    }

    function showResellerReview(resellerId) {
        const reseller = mockResellers.find(r => r.id === resellerId);
        if (!reseller) return;
        document.getElementById('modal-reseller-name').textContent = `Analisar: ${reseller.name}`;
        document.getElementById('review-reseller-name').textContent = reseller.name;
        document.getElementById('review-reseller-doc').textContent = reseller.doc;
        document.getElementById('review-reseller-phone').textContent = reseller.phone;
        document.getElementById('review-reseller-email').textContent = reseller.email;
        
        document.getElementById('approve-btn').onclick = () => updateResellerStatus(resellerId, 'aprovado');
        document.getElementById('reprove-btn').onclick = () => updateResellerStatus(resellerId, 'reprovado');
        
        document.getElementById('reseller-review-modal').classList.add('active');
    }

    function updateResellerStatus(resellerId, newStatus) {
        const reseller = mockResellers.find(r => r.id === resellerId);
        if(reseller) {
            reseller.status = newStatus;
            localStorage.setItem('erpResellers', JSON.stringify(mockResellers));
            renderResellersTable();
            updateDashboard();
            closeModal('reseller-review-modal');
            showToast(`Revendedora ${newStatus === 'aprovado' ? 'aprovada' : 'reprovada'}!`, 'success');
        }
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
    }
    
    function togglePublished(productId) {
        const index = publishedProductIds.indexOf(productId);
        if (index > -1) {
            publishedProductIds.splice(index, 1);
        } else {
            publishedProductIds.push(productId);
        }
        localStorage.setItem('erpPublished', JSON.stringify(publishedProductIds));
        updateDashboard();
        showToast('Catálogo de revenda atualizado!', 'success');
    }

    // --- LÓGICA DO PAINEL DA REVENDEDORA ---
    function setupRevendedorPanel() {
        const navContainer = document.getElementById('revendedor-nav');
        navContainer.addEventListener('click', (e) => {
            const link = e.target.closest('.nav-link');
            if (!link) return;
            
            e.preventDefault();
            const pageId = link.dataset.page;
            
            navContainer.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');

            const mainContent = document.querySelector('#revendedor-view .main-content');
            mainContent.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            mainContent.querySelector(`#${pageId}`).classList.add('active');
            
            if(pageId === 'reseller-products') renderResellerProductsTable();
            if(pageId === 'reseller-settings') loadResellerSettings();
            
            feather.replace();
        });

        document.getElementById('apply-mass-margin').addEventListener('click', applyMassMargin);
        document.getElementById('save-settings-btn').addEventListener('click', saveResellerSettings);
        
        document.getElementById('logo-upload').addEventListener('change', (e) => handleImageUpload(e, 'logo-preview', 'logoUrl'));
        document.querySelectorAll('.banner-upload').forEach(input => {
            input.addEventListener('change', (e) => handleImageUpload(e, `banner-preview-${e.target.dataset.bannerId}`, `banner-${e.target.dataset.bannerId}`));
        });
    }

    function renderResellerProductsTable() {
        const tbody = document.getElementById('reseller-products-table-body');
        tbody.innerHTML = '';
        const resellerProducts = allApiProducts.filter(p => publishedProductIds.includes(p.id));

        if (resellerProducts.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Nenhum produto disponível no momento.</td></tr>';
            return;
        }

        resellerProducts.forEach(p => {
            const margin = resellerProductMargins[p.id] || 30;
            const finalPrice = p.preco_original * (1 + margin / 100);
            const isActive = resellerActiveProductIds.includes(p.id);
            const row = tbody.insertRow();

            row.insertCell().innerHTML = `<img src="${proxyImageUrl(p.imagem)}" alt="${p.nome}" class="product-image" onerror="this.src='https://placehold.co/40x40/DB1472/FFFFFF?text=X'">`;
            row.insertCell().textContent = p.nome;
            row.insertCell().textContent = `R$ ${p.preco_original.toFixed(2)}`;
            row.insertCell().textContent = `${margin}%`;
            row.insertCell().textContent = `R$ ${finalPrice.toFixed(2)}`;
            
            const activeCell = row.insertCell();
            const toggleLabel = document.createElement('label');
            toggleLabel.className = 'toggle-switch';
            const toggleInput = document.createElement('input');
            toggleInput.type = 'checkbox';
            toggleInput.checked = isActive;
            toggleInput.addEventListener('change', () => toggleResellerProductActive(p.id));
            toggleLabel.appendChild(toggleInput);
            toggleLabel.appendChild(document.createElement('span')).className = 'slider';
            activeCell.appendChild(toggleLabel);
            
            const actionsCell = row.insertCell();
            const editButton = document.createElement('button');
            editButton.className = 'btn';
            editButton.style.padding = '0.25rem 0.5rem';
            editButton.innerHTML = `<i data-feather="edit-2"></i>`;
            editButton.addEventListener('click', () => showResellerProductEditModal(p.id));
            actionsCell.appendChild(editButton);
        });
        feather.replace();
    }

    function toggleResellerProductActive(productId) {
        const index = resellerActiveProductIds.indexOf(productId);
        if (index > -1) {
            resellerActiveProductIds.splice(index, 1);
        } else {
            resellerActiveProductIds.push(productId);
        }
        localStorage.setItem('resellerActiveProducts', JSON.stringify(resellerActiveProductIds));
        showToast('Visibilidade do produto no seu catálogo atualizada!', 'success');
    }

    function showResellerProductEditModal(productId) {
        const product = allApiProducts.find(p => p.id === productId);
        if (!product) return;

        document.getElementById('modal-reseller-product-name').textContent = `Editar Margem: ${product.nome}`;
        const marginInput = document.getElementById('reseller-margin-input');
        marginInput.value = resellerProductMargins[productId] || 30;

        document.getElementById('save-reseller-margin-btn').onclick = () => saveResellerMargin(productId);

        document.getElementById('reseller-product-edit-modal').classList.add('active');
    }

    function saveResellerMargin(productId) {
        const marginInput = document.getElementById('reseller-margin-input');
        const newMargin = parseFloat(marginInput.value);

        if (isNaN(newMargin) || newMargin < 0) {
            showToast('Por favor, insira uma margem válida.', 'error');
            return;
        }

        resellerProductMargins[productId] = newMargin;
        localStorage.setItem('resellerMargins', JSON.stringify(resellerProductMargins));
        
        renderResellerProductsTable();
        closeModal('reseller-product-edit-modal');
        showToast('Margem do produto atualizada!', 'success');
    }

    function applyMassMargin() {
        const marginInput = document.getElementById('mass-margin-input');
        const newMargin = parseFloat(marginInput.value);

        if (isNaN(newMargin) || newMargin < 0) {
            showToast('Por favor, insira uma margem válida para aplicar em massa.', 'error');
            return;
        }

        const resellerProducts = allApiProducts.filter(p => publishedProductIds.includes(p.id));
        resellerProducts.forEach(p => {
            resellerProductMargins[p.id] = newMargin;
        });

        localStorage.setItem('resellerMargins', JSON.stringify(resellerProductMargins));
        renderResellerProductsTable();
        showToast(`Margem de ${newMargin}% aplicada a todos os produtos!`, 'success');
    }

    function handleImageUpload(event, previewElementId, settingsKey) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            const imageUrl = e.target.result;
            document.getElementById(previewElementId).src = imageUrl;
            resellerSettings[settingsKey] = imageUrl;
        };
        reader.readAsDataURL(file);
    }

    function saveResellerSettings() {
        resellerSettings.brandName = document.getElementById('brand-name-input').value;
        resellerSettings.primaryColor = document.getElementById('primary-color-input').value;
        resellerSettings.secondaryColor = document.getElementById('secondary-color-input').value;
        resellerSettings.contactPhone = document.getElementById('contact-phone-input').value;
        resellerSettings.instagram = document.getElementById('instagram-input').value;
        resellerSettings.description = document.getElementById('description-textarea').value;

        localStorage.setItem('resellerSettings', JSON.stringify(resellerSettings));
        showToast('Configurações salvas com sucesso!', 'success');
    }

    function loadResellerSettings() {
        const settings = resellerSettings;
        document.getElementById('brand-name-input').value = settings.brandName || '';
        document.getElementById('primary-color-input').value = settings.primaryColor || '#DB1472';
        document.getElementById('secondary-color-input').value = settings.secondaryColor || '#F8B81F';
        document.getElementById('contact-phone-input').value = settings.contactPhone || '';
        document.getElementById('instagram-input').value = settings.instagram || '';
        document.getElementById('description-textarea').value = settings.description || '';

        if(settings.logoUrl) document.getElementById('logo-preview').src = settings.logoUrl;
        if(settings['banner-desktop-main']) document.getElementById('banner-preview-desktop-main').src = settings['banner-desktop-main'];
        if(settings['banner-mobile-main']) document.getElementById('banner-preview-mobile-main').src = settings['banner-mobile-main'];
    }

    </script>
</body>
</html>
